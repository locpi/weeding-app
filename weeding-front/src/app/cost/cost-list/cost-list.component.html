<div class="container mx-auto p-4">
	<h1 class="text-2xl font-bold mb-4">Mes dépenses</h1>
	<button (click)="openDialog()" class="mb-4" color="primary" mat-raised-button>
		Ajouter une dépense
	</button>
	<div class="mat-elevation-z8">
		<table [dataSource]="costLines" class="w-full" mat-table matSort multiTemplateDataRows>
			<!-- Name Column -->
			<ng-container matColumnDef="name">
				<th *matHeaderCellDef mat-header-cell mat-sort-header> Name</th>
				<td *matCellDef="let element" mat-cell> {{ element.name }}</td>
			</ng-container>

			<!-- Type Column -->
			<ng-container matColumnDef="type">
				<th *matHeaderCellDef mat-header-cell mat-sort-header> Type</th>
				<td *matCellDef="let element" mat-cell> {{ element.type }}</td>
			</ng-container>

			<!-- Adult Price Column -->
			<ng-container matColumnDef="adultPrice">
				<th *matHeaderCellDef mat-header-cell mat-sort-header> Adult Price</th>
				<td *matCellDef="let element" mat-cell> {{ element.adultPrice | currency }}</td>
			</ng-container>

			<!-- Child Price Column -->
			<ng-container matColumnDef="childPrice">
				<th *matHeaderCellDef mat-header-cell mat-sort-header> Child Price</th>
				<td *matCellDef="let element" mat-cell> {{ element.childPrice | currency }}</td>
			</ng-container>

			<!-- Total Column -->
			<ng-container matColumnDef="total">
				<th *matHeaderCellDef mat-header-cell mat-sort-header> Total</th>
				<td *matCellDef="let element" mat-cell> {{ getTotal(element) | currency }}</td>
			</ng-container>

			<!-- Actions Column -->
			<ng-container matColumnDef="actions">
				<th *matHeaderCellDef mat-header-cell> Actions</th>
				<td *matCellDef="let element" mat-cell>
					<button (click)="openDialog(element)" color="primary" mat-icon-button>
						<mat-icon>edit</mat-icon>
					</button>
					<button (click)="deleteCostLine(element)" color="warn" mat-icon-button>
						<mat-icon>delete</mat-icon>
					</button>
					<mat-icon fontIcon="expand_more"></mat-icon>
				</td>
			</ng-container>

			<!-- Expanded Content Column -->
			<ng-container matColumnDef="expandedDetail">
				<td *matCellDef="let element" [attr.colspan]="displayedColumns.length" mat-cell>
					<div [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'" class="element-detail">
						<div *ngIf="element.timeLineList?.length" class="w-full">
							<h3 class="text-lg font-semibold mb-2">Timelines</h3>
							<table class="w-full">
								<thead>
								<tr>
									<th>Due date</th>
									<th>Total</th>
									<th>Paid</th>
								</tr>

								</thead>
								<tbody>
								<tr *ngFor="let timeline of element.timeLineList">
									<td mat-line>Due: {{ timeline.dueDate | date }}</td>
									<td mat-line>Total: {{ timeline.total | currency }}</td>
									<td mat-line>Paid: {{ timeline.paid ? 'Yes' : 'No' }}</td>
								</tr>
								</tbody>
							</table>


						</div>
						<div *ngIf="!element.timeLineList?.length" class="text-gray-500">
							No timelines associated with this cost line.
						</div>
					</div>
				</td>
			</ng-container>

			<tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
			<tr (click)="expandedElement = expandedElement === element ? null : element"
				*matRowDef="let element; columns: displayedColumns;"
				[class.expanded-row]="expandedElement === element"
				class="element-row"
				mat-row>
			</tr>
			<tr *matRowDef="let row; columns: ['expandedDetail']" class="detail-row" mat-row></tr>
		</table>
	</div>
</div>